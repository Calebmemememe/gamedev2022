<head>
    <h5>version 0.0.8</h5>
    <h1 align=center>shoutout gaming</h1>
    <link rel="stylesheet" href="global.css">
    <title>objects</title>
    <style>
        canvas {
            padding-left: 0;
            padding-right: 0;
            margin-left: auto;
            margin-right: auto;
            display: block;
            width: 500px;
        }

    </style>
</head>
<body>
    <input type="button" id="dvd" value="start" onclick="{
        main();
    }"><div id="timer"></div>
    <canvas id="myCanvas" class="myCanvas" width="500" height="500" style="border: 1px solid #000000; background-color: #000000;"></canvas>
<script>
    var died = false;
    let timer = 0;
    let dx;
    let dy;
    let distance;
    let factor;
    let radius = 7.5;
    let key = [];
    var color = 'white';
    let Speed = 1;
    let canvas;
    let ctx;
    let image = new Image();

    let block0 = {
        x: 250,
        y: 250,
        xSpeed: 0,
        ySpeed: 0,
        radius: 10
    };

    const Enemies = [];
    class Enemy {
        constructor(x, y, xSpeed, ySpeed, Speed, enemyColor) {
            this.x = x;
            this.y = y;
            this.xSpeed = xSpeed;
            this.ySpeed = ySpeed;
            this.Speed = Speed;
            this.enemyColor = enemyColor;
        }
        update() {
            dx = block0.x - this.x;
            dy = block0.y - this.y;
            distance = Math.sqrt(dx*dx + dy*dy);
            factor = distance / this.Speed;
            this.xSpeed = dx / factor;
            this.ySpeed = dy / factor;
        }
        draw() {
            ctx.beginPath();
            ctx.fillStyle = this.enemyColor;
            ctx.arc(this.x, this.y, radius, 0, 2 * Math.PI, true);
            ctx.fill(); 
            this.x += this.xSpeed;
            this.y += this.ySpeed; 
        }
        collision() {
            if (this.x < 0){
                this.x = canvas.width;
            } 
            if (this.x > canvas.width){
                this.x = 0
            }  
            if (this.y < 0){
                this.y = canvas.height;
            } 
            if (this.y > canvas.height){
                this.y = 0
            } 
        }
        enemyCollide() {
            let G = 5
            let player_detect_radius = 5;
            let detect_radius = 100;
            Enemies.forEach((enemy) => {

                dx = block0.x - this.x;
                dy = block0.y - this.y;
                distance = Math.sqrt(dx*dx + dy*dy);

                let Edx = enemy.x - this.x;
                let Edy = enemy.y - this.y;               
                let enemyDistance = Math.sqrt(Edx*Edx + Edy*Edy);
                let theta = Math.acos(this.x/1000);

                if (this.x > enemy.x && this.y > enemy.y) {
                    theta = theta
                }else if (this.x > enemy.x && this.y < enemy.y) {
                    theta = 2 * Math.PI - theta
                }else if (this.x < enemy.x && this.y > enemy.y) {
                    theta = Math.PI + theta
                }else if (this.x < enemy.x && this.y < enemy.y) {
                    theta = Math.PI - theta
                }
                //Credit goes to Caleb Janzen and mr.gill's(chump) mind. because mrgill invented theta and math and cos. shoutout newton for gravity, he a real one

                let force = G / enemyDistance
                let xforce = Math.cos(theta) * force
                let yforce = Math.sin(theta) * force

                if (enemyDistance <= detect_radius && enemyDistance != 0) {
                    this.enemyColor = 'green';
                    this.x += xforce;
                    this.y += yforce;
                } 

                if (distance <= player_detect_radius && distance != 0) {
                    died = true;
                }
            })
        }

    }


function main() {
    canvas = document.getElementById("myCanvas");
    ctx = canvas.getContext("2d");

    spawnEnemy();
    update();
}

window.addEventListener('keydown', function (e) {
    key = (key || []);
    key[e.keyCode] = (e.type == "keydown");
})
window.addEventListener('keyup', function (e) {
    key[e.keyCode] = (e.type == "keydown");            
})

function spawnEnemy() {
    setTimeout(() => {
        Enemies.push(new Enemy(Math.floor(Math.random() * 500), Math.floor(Math.random() * 500), 0, 0, 0.8, 'red'));
        spawnEnemy();
    }, 1000)
}

function update() {
    const myTimeout = setTimeout(() => {
        timer += 0.01;
        document.getElementById('timer').innerHTML = Math.round(timer);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        hitWall();
        block0.xSpeed = 0;
        block0.ySpeed = 0;

        // if (key == 0) {block0.xSpeed = 0; block0.ySpeed = 0;}
        if (key && key[65]) {block0.xSpeed = -1; }
        if (key && key[68]) {block0.xSpeed = 1; }
        if (key && key[87]) {block0.ySpeed = -1; }
        if (key && key[83]) {block0.ySpeed = 1; };


        Enemies.forEach((enemy) => {
            enemy.enemyColor = 'red';
            enemy.update();
            enemy.draw();
            enemy.collision();
            enemy.enemyCollide();
        });

        draw0();
        update();   
    }, Speed)
    if (died == true) {
        clearTimeout(myTimeout);
        ctx.fillStyle = 'black';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = 'white'
        ctx.font = '48px Comic Sans'
        ctx.fillText('lmao noob', 250, 250)
    }
}

function draw0() {
    ctx.beginPath();
    ctx.fillStyle = color;
    ctx.arc(block0.x, block0.y, block0.radius, 0, 2 * Math.PI, true);
    ctx.fill(); 
    block0.x += block0.xSpeed
    block0.y += block0.ySpeed
}

function hitWall(){
    collision0();    
}

function collision0() {
    if (block0.x < 0){
        block0.x = canvas.width;
    } 
    if (block0.x > canvas.width){
        block0.x = 0
    }  
    if (block0.y < 0){
        block0.y = canvas.height;
    } 
    if (block0.y > canvas.height){
        block0.y = 0
    } 
}



</script>

</body>
