<!DOCTYPE html>
<head>
    <h1 align=center>shoutout gaming</h1>
    <link rel="stylesheet" href="global.css">
    <title>epic epic epic games</title>
    <style>
        canvas {
            padding-left: 0;
            padding-right: 0;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }
    </style>
</head>
<body>
    <input type="button" id="dvd" value="start" onclick="{
        main();
    }"><div id="timer">score: </div>

    <canvas id="myCanvas" class="myCanvas" width="500" height="500" style="border: 1px solid #000000; background-color: #000000;" onmousemove="{cursor(event);}"></canvas>
<script>
    let enemyCount = 0;
    let died = false;
    let timer = 0;
    let dx;
    let dy;
    let distance;
    let factor;
    let mouseX;
    let mouseY;
    let key = [];
    let color = 'white';
    let Speed = 1;
    let canvas = document.getElementById("myCanvas");
    let ctx = canvas.getContext("2d");
    ctx.fillStyle = 'white'
    ctx.font = '56px Times New Roman'
    ctx.fillText('press space to start', 40, canvas.height/2)
    let image = new Image();

    let block0 = {
        x: 250,
        y: 250,
        xSpeed: 0,
        ySpeed: 0,
        radius: 10
    };

    document.body.onkeydown = function(e) {
        if (e.keyCode == 32) {
            if (died == true) {
                location.reload();
            } else {
                main();
            }
        }}

    const Enemies = [];
    class Enemy {
        constructor(x, y, xSpeed, ySpeed, Speed, enemyColor, radius) {
            this.x = x;
            this.y = y;
            this.xSpeed = xSpeed;
            this.ySpeed = ySpeed;
            this.Speed = Speed;
            this.enemyColor = enemyColor;
            this.radius = radius;
        }
        update() {
            dx = block0.x - this.x;
            dy = block0.y - this.y;
            distance = Math.sqrt(dx*dx + dy*dy);
            factor = distance / this.Speed;
            let canvas_diagonal = Math.sqrt((canvas.height * canvas.height) + (canvas.width * canvas.width))
            if (distance >= canvas_diagonal/2) {
                this.xSpeed = -(dx / factor);
                this.ySpeed = -(dy / factor);
            } else {
                this.xSpeed = dx / factor;
                this.ySpeed = dy / factor;
            }
        }
        draw() {
            ctx.beginPath();
            ctx.fillStyle = this.enemyColor;
            ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI, true);
            ctx.fill(); 
            this.x += this.xSpeed;
            this.y += this.ySpeed; 
        }
        collision() {
            if (this.x < 0){
                this.x = canvas.width;
            } 
            if (this.x > canvas.width){
                this.x = 0
            }  
            if (this.y < 0){
                this.y = canvas.height;
            } 
            if (this.y > canvas.height){
                this.y = 0
            } 
        }
        enemyCollide() {
            let G = 2;
            let player_detect_radius = 10;
            let detect_radius = 50;
            Enemies.forEach((enemy) => {

                dx = block0.x - this.x;
                dy = block0.y - this.y;
                distance = Math.sqrt(dx*dx + dy*dy);

                let Edx = enemy.x - this.x;
                let Edy = enemy.y - this.y;               
                let enemyDistance = Math.sqrt(Edx*Edx + Edy*Edy);
                let theta = Math.acos(this.x/10000);

                if (this.x > enemy.x && this.y > enemy.y) {
                    theta = theta
                }else if (this.x > enemy.x && this.y < enemy.y) {
                    theta = 2 * Math.PI - theta
                }else if (this.x < enemy.x && this.y > enemy.y) {
                    theta = Math.PI + theta
                }else if (this.x < enemy.x && this.y < enemy.y) {
                    theta = Math.PI - theta
                }
                //Credit goes to Caleb Janzen'd for math to code translating and mr.gill's(chump) mind. because mrgill invented theta and math and cos. shoutout newton 4 gravity

                let force = G / enemyDistance
                let xforce = Math.cos(theta) * force
                let yforce = Math.sin(theta) * force

                if (enemyDistance <= detect_radius && enemyDistance != 0) {
                    this.x += xforce;
                    this.y += yforce;
                } 

                if (distance <= player_detect_radius && distance != 0) {
                    died = true;
                }
            })
        }

    }

    const Bullets = []
    class Bullet {
        constructor(x, y, xSpeed, ySpeed, Speed, bulletColor, radius) {
            this.x = x;
            this.y = y;
            this.xSpeed = xSpeed;
            this.ySpeed = ySpeed;
            this.Speed = Speed;
            this.bulletColor = bulletColor;
            this.radius = radius;
        }
        update() {
            // this.x += this.xSpeed;
            // this.y += this.ySpeed;
        }
        draw() {
            ctx.beginPath();
            ctx.fillStyle = this.bulletColor;
            ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI, true);
            ctx.fill(); 
            this.x += this.xSpeed * 3;
            this.y += this.ySpeed * 3; 
        }
        collision() {
            if (this.x < 0){
                Bullets.splice(this, 1)
            } 
            if (this.x > canvas.width){
                Bullets.splice(this, 1)
            }  
            if (this.y < 0){
                Bullets.splice(this, 1)
            } 
            if (this.y > canvas.height){
                Bullets.splice(this, 1)
            } 
        }
        bulletCollide() {
            let detect_radius = 50;
            Enemies.forEach((enemy) => {
                dx = enemy.x - this.x;
                dy = enemy.y - this.y;
                distance = Math.sqrt(dx*dx + dy*dy);
                if (distance < 10) {
                    Enemies.splice(enemy, 1)
                    Bullets.splice(this, 1)
                }
            })
        }

    }

function main() {
    spawnEnemy();
    update();
}

window.addEventListener('keydown', function (e) {
    key = (key || []);
    key[e.keyCode] = (e.type == "keydown");
})
window.addEventListener('keyup', function (e) {
    key[e.keyCode] = (e.type == "keydown");            
})
setTimeout(function (){
window.addEventListener('click', function (e) {
    spawnBullet();
})
},1000)

function cursor(event) {
    mouseX = event.offsetX;
    mouseY = event.offsetY;
}

function spawnEnemy() {
    setTimeout(() => {
        enemyCount += 1;
        deadzone = 100;
        x = Math.floor(Math.random() * canvas.width);
        y = Math.floor(Math.random() * canvas.height)

        dx = block0.x - x;
        dy = block0.y - y;
        distance = Math.sqrt(dx*dx + dy*dy);

        if (distance <= deadzone) {
            spawnEnemy();
        } else {
            if (enemyCount % 10 == 0) {
                Enemies.push(new Enemy(x, y, 0, 0, 0.8, 'red', 15));
                spawnEnemy();
            } else {
                Enemies.push(new Enemy(x, y, 0, 0, 0.8, 'red', 7.5));
                spawnEnemy();
            }
        }
    }, 500)
}

function spawnBullet() {
    x = block0.x;
    y = block0.y;
    let Cursordx = mouseX - block0.x;
    let Cursordy = mouseY - block0.y;
    distance = Math.sqrt(Cursordx*Cursordx + Cursordy*Cursordy);
    factor = distance / 1;
    xSpeed = Cursordx / factor;
    ySpeed = Cursordy / factor;
    Bullets.push(new Bullet(x, y, xSpeed, ySpeed, 1, 'goldenrod', 5));
}

function update() {
    const myTimeout = setTimeout(() => {
        timer += 0.01;
        document.getElementById('timer').innerHTML = 'score: ' + Math.round(timer);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        hitWall();
        block0.xSpeed = 0;
        block0.ySpeed = 0;


        if (key && key[65]) {block0.xSpeed = -1; }
        if (key && key[68]) {block0.xSpeed = 1; }
        if (key && key[87]) {block0.ySpeed = -1; }
        if (key && key[83]) {block0.ySpeed = 1; };


        Enemies.forEach((enemy) => {
            enemy.update();
            enemy.draw();
            enemy.collision();
            enemy.enemyCollide();
        });

        Bullets.forEach((bullet) => {
            bullet.update();
            bullet.draw();
            bullet.collision();
            bullet.bulletCollide();
        });

        draw0();
        update();   
    }, Speed)
    if (died == true) {
        clearTimeout(myTimeout);
        ctx.fillStyle = 'black';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = 'white'
        ctx.font = '56px Brush Script MT'
        ctx.fillText('ðŸ¤“lmao noob', canvas.width/2.2, canvas.height/2)
        ctx.font = '24px Comic Sans'
        ctx.fillText('press space to restart', canvas.width/2, canvas.height/1.8)
    }
}

function draw0() {
    ctx.beginPath();
    ctx.fillStyle = color;
    ctx.arc(block0.x, block0.y, block0.radius, 0, 2 * Math.PI, true);
    ctx.fill(); 
    block0.x += block0.xSpeed
    block0.y += block0.ySpeed
}

function hitWall(){
    collision0();    
}

function collision0() {
    if (block0.x < 0){
        block0.x = canvas.width;
    } 
    if (block0.x > canvas.width){
        block0.x = 0
    }  
    if (block0.y < 0){
        block0.y = canvas.height;
    } 
    if (block0.y > canvas.height){
        block0.y = 0
    } 
}



</script>

</body>
